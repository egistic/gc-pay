# Чек-лист реализации аутентификации

## Подготовка

### Backend
- [ ] Создать модуль аутентификации `app/modules/auth/`
- [ ] Добавить JWT зависимости в `requirements.txt`
- [ ] Создать модели для пользователей и ролей
- [ ] Настроить JWT секреты в конфигурации

### Frontend
- [ ] Создать контекст аутентификации `context/AuthContext.tsx`
- [ ] Создать сервис аутентификации `services/auth/authService.ts`
- [ ] Создать хуки для работы с пользователями
- [ ] Создать компоненты входа/регистрации

## Этап 1: Backend аутентификация

### Модели и база данных
- [ ] Создать `app/modules/users/user_models.py`
- [ ] Создать `app/modules/users/user_roles_models.py`
- [ ] Создать миграцию для новых полей
- [ ] Применить миграцию к базе данных

### Сервисы
- [ ] Создать `app/modules/users/user_service.py`
- [ ] Создать `app/modules/auth/auth_service.py`
- [ ] Реализовать хеширование паролей
- [ ] Реализовать JWT токены

### API эндпоинты
- [ ] Создать `app/modules/auth/auth_router.py`
- [ ] Реализовать `/auth/login`
- [ ] Реализовать `/auth/me`
- [ ] Реализовать `/auth/refresh`
- [ ] Добавить middleware для проверки токенов

### Безопасность
- [ ] Настроить CORS для аутентификации
- [ ] Добавить rate limiting для входа
- [ ] Реализовать валидацию паролей
- [ ] Добавить логирование аутентификации

## Этап 2: Frontend аутентификация

### Контекст и состояние
- [ ] Создать `context/AuthContext.tsx`
- [ ] Реализовать сохранение токена в localStorage
- [ ] Реализовать автоматическое обновление токена
- [ ] Добавить обработку ошибок аутентификации

### Сервисы
- [ ] Создать `services/auth/authService.ts`
- [ ] Реализовать HTTP клиент с токенами
- [ ] Добавить перехватчики для обновления токенов
- [ ] Реализовать обработку ошибок 401

### Компоненты
- [ ] Создать `components/auth/LoginForm.tsx`
- [ ] Создать `components/auth/LogoutButton.tsx`
- [ ] Создать `components/ProtectedRoute.tsx`
- [ ] Создать `components/UnauthorizedPage.tsx`

### Хуки
- [ ] Создать `hooks/useAuth.ts`
- [ ] Создать `hooks/useCurrentUser.ts`
- [ ] Создать `hooks/usePermissions.ts`
- [ ] Создать `hooks/useRoleCheck.ts`

## Этап 3: Замена захардкоженных ID

### Поиск и замена
- [ ] Найти все вхождения `3394830b-1b62-4db4-a6e4-fdf76b5033f5`
- [ ] Найти все вхождения `6c626090-ab4a-44c2-a16d-01b73423557b`
- [ ] Найти все вхождения `8e1ff15d-79ea-48a6-ba30-59f64dcc9f6d`
- [ ] Заменить на динамические значения

### Компоненты для обновления
- [ ] `components/executor/OptimizedCreateRequestForm.tsx`
- [ ] `components/layout/Navigation.tsx`
- [ ] `components/App/AppRouter.tsx`
- [ ] `components/sub-registrar/SubRegistrarDashboard.tsx`

### Сервисы для обновления
- [ ] `services/paymentRequestService.ts`
- [ ] `services/statisticsService.ts`
- [ ] `services/distributionService.ts`

## Этап 4: Система ролей

### Backend роли
- [ ] Создать эндпоинт для получения ролей пользователя
- [ ] Реализовать проверку ролей в middleware
- [ ] Добавить роли в JWT токен
- [ ] Создать API для управления ролями

### Frontend роли
- [ ] Реализовать проверку ролей в компонентах
- [ ] Создать условный рендеринг по ролям
- [ ] Добавить защиту роутов по ролям
- [ ] Создать компонент выбора роли

## Этап 5: Миграция данных

### Подготовка
- [ ] Создать backup базы данных
- [ ] Создать скрипт миграции данных
- [ ] Протестировать миграцию на копии данных
- [ ] Подготовить rollback план

### Выполнение миграции
- [ ] Остановить приложение
- [ ] Выполнить backup
- [ ] Применить миграцию базы данных
- [ ] Обновить данные пользователей
- [ ] Запустить приложение
- [ ] Проверить работоспособность

## Этап 6: Тестирование

### Unit тесты
- [ ] Тесты для аутентификации
- [ ] Тесты для авторизации
- [ ] Тесты для ролей
- [ ] Тесты для миграции данных

### Интеграционные тесты
- [ ] Тест полного цикла входа
- [ ] Тест доступа к защищенным ресурсам
- [ ] Тест обновления токенов
- [ ] Тест выхода из системы

### E2E тесты
- [ ] Тест входа пользователя
- [ ] Тест создания заявки
- [ ] Тест доступа по ролям
- [ ] Тест обработки ошибок

## Этап 7: Развертывание

### Подготовка к продакшену
- [ ] Настроить переменные окружения
- [ ] Обновить Docker конфигурацию
- [ ] Настроить SSL сертификаты
- [ ] Подготовить мониторинг

### Развертывание
- [ ] Развернуть на staging окружении
- [ ] Протестировать на staging
- [ ] Развернуть на production
- [ ] Мониторить ошибки и производительность

## Этап 8: Мониторинг и поддержка

### Логирование
- [ ] Настроить логи аутентификации
- [ ] Добавить метрики входа/выхода
- [ ] Настроить алерты на ошибки
- [ ] Создать дашборд мониторинга

### Документация
- [ ] Обновить API документацию
- [ ] Создать руководство пользователя
- [ ] Документировать процесс миграции
- [ ] Создать troubleshooting guide

## Проверка качества

### Код ревью
- [ ] Проверить безопасность JWT токенов
- [ ] Проверить обработку ошибок
- [ ] Проверить валидацию входных данных
- [ ] Проверить производительность

### Безопасность
- [ ] Проверить защиту от CSRF
- [ ] Проверить защиту от XSS
- [ ] Проверить валидацию паролей
- [ ] Проверить rate limiting

### Производительность
- [ ] Проверить время ответа API
- [ ] Проверить использование памяти
- [ ] Проверить нагрузку на базу данных
- [ ] Оптимизировать запросы

## Заключение

После выполнения всех пунктов чек-листа система будет полностью интегрирована с реальными пользователями и готова к продакшену.

### Критерии готовности
- [ ] Все тесты проходят
- [ ] Нет захардкоженных ID в коде
- [ ] Система ролей работает корректно
- [ ] Миграция данных выполнена успешно
- [ ] Мониторинг настроен
- [ ] Документация обновлена
